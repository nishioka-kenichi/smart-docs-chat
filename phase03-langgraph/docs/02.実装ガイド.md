# Phase 3 LangGraphã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ - å®Ÿè£…ã‚¬ã‚¤ãƒ‰

## ğŸ“Œ æ¦‚è¦

Phase 3ã§ã¯ã€LangGraphã‚’ä½¿ç”¨ã—ã¦è‡ªå¾‹çš„ã«å‹•ä½œã™ã‚‹AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚
æœ¬ã‚¬ã‚¤ãƒ‰ã§ã¯ã€å®Ÿè£…ã®è©³ç´°ã¨ä½¿ç”¨æ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚

---

## ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### 1. ç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
# Phase 3ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
cd phase03-langgraph

# Pythonä»®æƒ³ç’°å¢ƒã®ä½œæˆã¨æœ‰åŠ¹åŒ–
python -m venv .venv
source .venv/bin/activate  # Windows: .venv\Scripts\activate

# ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install -r requirements.txt
```

### 2. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

```bash
# .envãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
cp .env.example .env

# .envãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã¦å¿…è¦ãªæƒ…å ±ã‚’è¨­å®š
# å¿…é ˆ:
#   - OPENAI_API_KEY
# ã‚ªãƒ—ã‚·ãƒ§ãƒ³:
#   - TAVILY_API_KEY (Webæ¤œç´¢ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆ)
#   - CHROMADB_PATH (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: ../phase01-local/data/chromadb)
```

### 3. åŸºæœ¬çš„ãªå®Ÿè¡Œ

```bash
# å¯¾è©±ãƒ¢ãƒ¼ãƒ‰ã§èµ·å‹•
python src/main.py

# å˜ä¸€ã®ã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œ
python src/main.py "ç¤¾å†…ã®å°±æ¥­è¦å‰‡ã«ã¤ã„ã¦æ•™ãˆã¦ãã ã•ã„"

# è©³ç´°ãƒ­ã‚°ã‚’éè¡¨ç¤ºã«ã™ã‚‹
python src/main.py --quiet "è³ªå•å†…å®¹"

# ã‚°ãƒ©ãƒ•ã®å¯è¦–åŒ–
python src/main.py --visualize
```

---

## ğŸ’» ä½¿ç”¨æ–¹æ³•

### å¯¾è©±ãƒ¢ãƒ¼ãƒ‰

å¯¾è©±ãƒ¢ãƒ¼ãƒ‰ã§ã¯ã€ç¶™ç¶šçš„ã«è³ªå•ã‚’å…¥åŠ›ã§ãã¾ã™ï¼š

```bash
$ python src/main.py --interactive

ğŸ¤– LangGraph Agent - Interactive Mode
============================================================
Commands:
  /exit    - çµ‚äº†
  /clear   - ä¼šè©±å±¥æ­´ã‚’ã‚¯ãƒªã‚¢
  /save    - ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã‚’ä¿å­˜
  /load    - ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã‹ã‚‰å¾©å…ƒ
  /list    - ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆä¸€è¦§
  /tools   - åˆ©ç”¨å¯èƒ½ãªãƒ„ãƒ¼ãƒ«ä¸€è¦§
  /help    - ãƒ˜ãƒ«ãƒ—ã‚’è¡¨ç¤º
============================================================

ğŸ§‘ You: Notionã«ã‚ã‚‹å–¶æ¥­è³‡æ–™ã«ã¤ã„ã¦æ•™ãˆã¦

ğŸ¤– Agent: Thinking...

[æ¨è«–ãƒ—ãƒ­ã‚»ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã¾ã™]

ğŸ¤– Agent: å–¶æ¥­è³‡æ–™ã«ã¤ã„ã¦ä»¥ä¸‹ã®æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ...
```

### ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°

```bash
# ãƒ˜ãƒ«ãƒ—ã‚’è¡¨ç¤º
python src/main.py --help

# ã‚ªãƒ—ã‚·ãƒ§ãƒ³:
#   query               å‡¦ç†ã™ã‚‹ã‚¯ã‚¨ãƒªï¼ˆçœç•¥æ™‚ã¯å¯¾è©±ãƒ¢ãƒ¼ãƒ‰ï¼‰
#   --interactive, -i   å¯¾è©±ãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œ
#   --resume ID         ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆIDã‹ã‚‰å†é–‹
#   --config PATH       è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹
#   --quiet, -q         è©³ç´°ãƒ­ã‚°ã‚’éè¡¨ç¤º
#   --visualize, -v     ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚°ãƒ©ãƒ•ã‚’å¯è¦–åŒ–
```

---

## ğŸ”§ è¨­å®šã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

### config/settings.yaml

ä¸»è¦ãªè¨­å®šé …ç›®ï¼š

```yaml
# ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè¨­å®š
agent:
  max_iterations: 10          # æœ€å¤§æ¨è«–ãƒ«ãƒ¼ãƒ—æ•°
  timeout_seconds: 60         # ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚é–“
  verbose: true              # è©³ç´°ãƒ­ã‚°å‡ºåŠ›

# LLMè¨­å®š
llm:
  model: "gpt-4o-mini"       # ä½¿ç”¨ã™ã‚‹ãƒ¢ãƒ‡ãƒ«
  temperature: 0.7           # ç”Ÿæˆã®å¤šæ§˜æ€§
  max_tokens: 2000          # æœ€å¤§ãƒˆãƒ¼ã‚¯ãƒ³æ•°

# ãƒ„ãƒ¼ãƒ«è¨­å®š
tools:
  rag_search:
    enabled: true            # RAGæ¤œç´¢ã‚’æœ‰åŠ¹åŒ–
    top_k: 5                # æ¤œç´¢çµæœæ•°
  web_search:
    enabled: false          # Webæ¤œç´¢ï¼ˆè¦APIã‚­ãƒ¼ï¼‰
  calculator:
    enabled: true           # è¨ˆç®—ãƒ„ãƒ¼ãƒ«
  file_handler:
    enabled: true           # ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œ
```

---

## ğŸ› ï¸ ãƒ„ãƒ¼ãƒ«ã®ä½¿ç”¨

### åˆ©ç”¨å¯èƒ½ãªãƒ„ãƒ¼ãƒ«

1. **RAGæ¤œç´¢** (`rag_search`)
   - Phase 1ã®ChromaDBã‚’ä½¿ç”¨
   - ç¤¾å†…ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ¤œç´¢

2. **è¨ˆç®—æ©Ÿ** (`calculator`)
   - æ•°å¼ã®è©•ä¾¡
   - åŸºæœ¬çš„ãªæ•°å­¦é–¢æ•°

3. **ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œ** (`read_file`, `write_file`)
   - ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿æ›¸ã
   - å¯¾å¿œå½¢å¼: .txt, .md, .json, .csv

4. **Webæ¤œç´¢** (`web_search`) â€»ã‚ªãƒ—ã‚·ãƒ§ãƒ³
   - Tavily APIã‚’ä½¿ç”¨
   - æœ€æ–°æƒ…å ±ã®å–å¾—

### ãƒ„ãƒ¼ãƒ«ã®è¿½åŠ æ–¹æ³•

æ–°ã—ã„ãƒ„ãƒ¼ãƒ«ã‚’è¿½åŠ ã™ã‚‹å ´åˆï¼š

```python
# src/tools.pyã«è¿½åŠ 

def _setup_custom_tool(self):
    """ã‚«ã‚¹ã‚¿ãƒ ãƒ„ãƒ¼ãƒ«ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—"""
    tool = StructuredTool.from_function(
        func=self._custom_function,
        name="custom_tool",
        description="ãƒ„ãƒ¼ãƒ«ã®èª¬æ˜",
        args_schema=CustomToolInput
    )
    self.tools.append(tool)

def _custom_function(self, param: str) -> str:
    """ã‚«ã‚¹ã‚¿ãƒ æ©Ÿèƒ½ã®å®Ÿè£…"""
    # å‡¦ç†ã‚’å®Ÿè£…
    return "çµæœ"
```

---

## ğŸ” ãƒ‡ãƒãƒƒã‚°ã¨ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### è©³ç´°ãƒ­ã‚°ã®æœ‰åŠ¹åŒ–

```python
# ã‚³ãƒ¼ãƒ‰å†…ã§è¨­å®š
agent = ReActAgent(verbose=True)

# ã¾ãŸã¯ç’°å¢ƒå¤‰æ•°ã§è¨­å®š
export LANGGRAPH_LOG_LEVEL=DEBUG
```

### ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•

#### 1. ChromaDBã¸ã®æ¥ç¶šã‚¨ãƒ©ãƒ¼

```bash
# Phase 1ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ‘ã‚¹ã‚’ç¢ºèª
export CHROMADB_PATH="../phase01-local/data/chromadb"

# Phase 1ã§ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’å†æ§‹ç¯‰
cd ../phase01-local
python src/indexer.py
```

#### 2. OpenAI APIã‚¨ãƒ©ãƒ¼

```bash
# APIã‚­ãƒ¼ã®ç¢ºèª
echo $OPENAI_API_KEY

# ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®å ´åˆã¯å¾…æ©Ÿ
# ã¾ãŸã¯.envã§ãƒ¢ãƒ‡ãƒ«ã‚’å¤‰æ›´
OPENAI_MODEL=gpt-3.5-turbo
```

#### 3. ãƒ¡ãƒ¢ãƒªä¸è¶³

```yaml
# config/settings.yamlã§èª¿æ•´
agent:
  max_iterations: 5  # ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ•°ã‚’æ¸›ã‚‰ã™
llm:
  max_tokens: 1000   # ãƒˆãƒ¼ã‚¯ãƒ³æ•°ã‚’æ¸›ã‚‰ã™
```

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ

```bash
# å…¨ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
pytest tests/

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œ
pytest tests/test_agent.py -v

# ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆä»˜ã
pytest tests/ --cov=src --cov-report=html
```

### ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

- `test_agent.py`: ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¨Stateç®¡ç†ã®ãƒ†ã‚¹ãƒˆ
- `test_tools.py`: å„ãƒ„ãƒ¼ãƒ«ã®å˜ä½“ãƒ†ã‚¹ãƒˆ  
- `test_graph.py`: ã‚°ãƒ©ãƒ•æ§‹ç¯‰ã¨å®Ÿè¡Œã®ãƒ†ã‚¹ãƒˆ

---

## ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°

### å¿œç­”é€Ÿåº¦ã®æ”¹å–„

```yaml
# config/settings.yaml
llm:
  streaming: true           # ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°æœ‰åŠ¹åŒ–
  model: "gpt-3.5-turbo"   # è»½é‡ãƒ¢ãƒ‡ãƒ«ä½¿ç”¨

graph:
  enable_parallel: true     # ä¸¦åˆ—å‡¦ç†æœ‰åŠ¹åŒ–
  enable_caching: true      # ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ‰åŠ¹åŒ–
```

### ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®å‰Šæ¸›

```yaml
checkpoint:
  compression: true         # åœ§ç¸®ä¿å­˜
  max_checkpoints: 5       # ä¿å­˜æ•°åˆ¶é™
  auto_save: false         # è‡ªå‹•ä¿å­˜ç„¡åŠ¹åŒ–
```

---

## ğŸ”„ ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆæ©Ÿèƒ½

### ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã®ç®¡ç†

```python
# ãƒ—ãƒ­ã‚°ãƒ©ãƒ å†…ã§ã®ä½¿ç”¨
from checkpointer import CheckpointManager

manager = CheckpointManager()

# ä¿å­˜
checkpoint_id = manager.save_checkpoint(
    state=current_state,
    step_name="reasoning",
    iteration=3
)

# èª­ã¿è¾¼ã¿
checkpoint = manager.load_checkpoint(checkpoint_id)

# ä¸€è¦§å–å¾—
checkpoints = manager.list_checkpoints()
```

### å¯¾è©±ãƒ¢ãƒ¼ãƒ‰ã§ã®ä½¿ç”¨

```bash
# ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆä¸€è¦§ã‚’è¡¨ç¤º
/list

# æœ€æ–°ã®ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆã‹ã‚‰å†é–‹
/load

# ç¾åœ¨ã®çŠ¶æ…‹ã‚’ä¿å­˜
/save
```

---

## ğŸ“ˆ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã¨ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°

### å®Ÿè¡Œçµ±è¨ˆã®ç¢ºèª

å®Ÿè¡Œå¾Œã«ä»¥ä¸‹ã®æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼š

- **Reasoning steps**: æ¨è«–ã‚¹ãƒ†ãƒƒãƒ—æ•°
- **Tool calls**: ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—å›æ•°
- **Iterations**: ç·ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ•°
- **Response time**: å¿œç­”æ™‚é–“

### ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª

```bash
# ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®å ´æ‰€
tail -f data/logs/agent.log

# ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã®å¤‰æ›´
export LANGGRAPH_LOG_LEVEL=INFO  # DEBUG, INFO, WARNING, ERROR
```

---

## ğŸš€ ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ç’°å¢ƒã¸ã®å±•é–‹

### æ¨å¥¨è¨­å®š

```yaml
# config/settings.yaml (æœ¬ç•ªç’°å¢ƒç”¨)
agent:
  max_iterations: 10
  timeout_seconds: 30
  verbose: false

llm:
  model: "gpt-4o-mini"
  temperature: 0.3  # ã‚ˆã‚Šç¢ºå®šçš„ãªå¿œç­”

checkpoint:
  enabled: true
  compression: true
  max_checkpoints: 20

logging:
  level: "WARNING"
  rotate_size: "100MB"
```

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

1. **APIã‚­ãƒ¼ã®ç®¡ç†**
   - ç’°å¢ƒå¤‰æ•°ã§ç®¡ç†
   - ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆç®¡ç†ã‚µãƒ¼ãƒ“ã‚¹ã®ä½¿ç”¨

2. **å…¥åŠ›ã®ã‚µãƒ‹ã‚¿ã‚¤ã‚º**
   ```yaml
   security:
     sanitize_inputs: true
     max_input_length: 5000
   ```

3. **ãƒ¬ãƒ¼ãƒˆåˆ¶é™**
   ```yaml
   security:
     rate_limit: 60  # ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/åˆ†
   ```

---

## ğŸ“š å‚è€ƒãƒªãƒ³ã‚¯

- [LangGraphå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://github.com/langchain-ai/langgraph)
- [ReActãƒ‘ã‚¿ãƒ¼ãƒ³è«–æ–‡](https://arxiv.org/abs/2210.03629)
- [Phase 1 README](../phase01-local/README.md)
- [Phase 2 README](../phase02-advanced-rag/README.md)

---

*æœ€çµ‚æ›´æ–°: 2025å¹´1æœˆ22æ—¥*