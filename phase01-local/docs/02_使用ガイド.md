# CLIチャット使用ガイド

## 🚀 クイックスタート

### 起動方法
```bash
# 仮想環境をアクティベート
source .venv/bin/activate

# CLIチャットを起動
python src/cli_chat.py
```

## 💬 基本的な使い方

### 質問の入力
```
👤 You: スマートグラフの就業規則について教えてください

🤖 回答:
スマートグラフ合同会社の就業規則について、以下のポイントをまとめました...
```

### 応答の構成
1. **回答本文**: AIが生成した回答
2. **処理時間**: 応答生成にかかった時間
3. **参照ソース**: 回答の根拠となった文書（上位3件）

## 📝 コマンド一覧

| コマンド | 説明 | 使用例 |
|----------|------|--------|
| `/help` | 利用可能なコマンドを表示 | `/help` |
| `/history` | 会話履歴を表示 | `/history` |
| `/clear` | 会話履歴をクリア | `/clear` |
| `/search <query>` | ドキュメント検索のみ実行（回答生成なし） | `/search 有給休暇` |
| `/sources` | 最後の回答の詳細なソース情報を表示 | `/sources` |
| `/save` | 会話履歴をJSONファイルに保存 | `/save` |
| `/stats` | セッション統計を表示 | `/stats` |
| `/exit` または `/quit` | チャットを終了 | `/exit` |

## 🎨 表示の見方

### カラーコード
- 🔵 **青**: ユーザーの入力
- 🟢 **緑**: AIの回答、成功メッセージ
- 🔷 **シアン**: システムメッセージ、処理中
- 🟡 **黄**: 警告、注意
- 🔴 **赤**: エラーメッセージ

### スコア表示
```
📚 検索結果 (10件):
1. [notion] 就業規則 (スコア: 0.817)  ← 高い関連性
2. [google_drive] 労務規程.pdf (スコア: 0.652)  ← 中程度の関連性
3. [notion] 勤怠管理 (スコア: 0.431)  ← 低い関連性
```

- **0.8以上**: 🟢 非常に高い関連性
- **0.6-0.8**: 🔷 高い関連性
- **0.6未満**: 🟡 参考程度

## 🔍 検索機能の詳細

### ドキュメント検索（/search）
回答を生成せず、関連文書の検索のみを実行します。

```
👤 You: /search 在宅勤務

🔍 検索中: '在宅勤務'

📚 検索結果 (10件):
1. [notion] リモートワーク規定 (スコア: 0.823)
   フルリモート勤務を採用しており、コアタイムは10:00から14:00...

2. [google_drive] 就業規則.pdf (スコア: 0.756)
   第5章 勤務形態 - 在宅勤務は事前申請により...
```

### ソース詳細表示（/sources）
最後の回答で使用されたソース文書の詳細を表示します。

```
👤 You: /sources

📚 参照ソース詳細:
1. [notion] 全社案内-就業時間について
   スコア: 0.693
   内容プレビュー:
   フルリモート勤務とフレックスタイム制を採用しています...
```

## 💾 会話履歴の管理

### 履歴の保存
```
👤 You: /save

✅ 会話履歴を保存しました: ./data/chat_logs/chat_history_20250120_141530.json
```

### 保存される内容
- セッション開始・終了時刻
- 質問数
- 全ての会話内容
- 各質問への回答と参照ソース

### 履歴のクリア
```
👤 You: /clear

💨 会話履歴をクリアしました
```

## 📊 セッション統計

```
👤 You: /stats

📊 セッション統計:
--------------------------------------------------
  開始時刻: 2025-01-20 14:00:00
  経過時間: 15.3分
  質問数: 5回
  平均応答時間: 3.1分/質問
  会話履歴: 10メッセージ
--------------------------------------------------
```

## ⚠️ トラブルシューティング

### よくあるエラーと対処法

#### 1. 初期化エラー
```
❌ 初期化エラー: [エラー内容]
```
**対処法**:
- `.env`ファイルにAPIキーが設定されているか確認
- `python src/indexer.py`でベクトルDBが作成されているか確認
- ネットワーク接続を確認

#### 2. 検索結果が0件
```
📭 関連ドキュメントが見つかりませんでした
```
**対処法**:
- より一般的なキーワードで検索
- 日本語の表記ゆれに注意（例：「有給」「有給休暇」「年次有給休暇」）

#### 3. 応答が遅い
**対処法**:
- OpenAI APIの状態を確認
- ネットワーク速度を確認
- `config/settings.yaml`でretriever.kを減らす（10→5）

## 🎯 効果的な質問のコツ

### 良い質問の例
- ✅ 「有給休暇の取得方法について教えてください」
- ✅ 「リモートワークの規定は？」
- ✅ 「新入社員の研修内容を説明して」

### 避けるべき質問
- ❌ 「これ」「あれ」など文脈依存の指示語
- ❌ 極端に短い単語（「休暇」だけなど）
- ❌ 複数の無関係なトピックを含む質問

## 🔐 セキュリティ上の注意

- 会話履歴には社内情報が含まれる可能性があります
- `/save`で保存したファイルは適切に管理してください
- 共有PCで使用後は必ず`/clear`を実行してください

## 📈 パフォーマンス目安

| 処理 | 通常時間 | 備考 |
|------|----------|------|
| 起動 | 2-3秒 | ベクトルDB読み込み |
| 検索 | 1-2秒 | 830チャンクから検索 |
| 回答生成 | 5-10秒 | GPT-4使用時 |
| 全体 | 8-12秒 | 質問から回答まで |

---

最終更新: 2025年1月20日